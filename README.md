# DockerでROSのビルド環境,実行環境を構築する
## 事前準備

### DokcerCEをインストール
[公式ページ]()を参考にDockerCEをインストールする．

### USBデバイスを使う場合
Docker内でのusbデバイスの使用方法にいて
方法は２つある．

1. 特定のデバイスに対してのアクセスを許可する
2. コンテナに特権を与える

どちらもdocker run するときにオプションを与えるだけでできる．
ただし、マウントとかと同じでコンテナを作る段階でしか有効化できないので注意が必要．

どう考えても１のほうが良いのだが、後述する１の方法ではrosで開発していくうえではうっとうしい場合がおおい.


#### 特定デバイスに対してのアクセスを許可する方法
docker run のオプションに`-device=/dev/ttyxxx:/dev/ttyxxx`を追加する．
コントローラ使いたい場合も同様に`-device=/dev/input/jy0:/dev/input/jy0`とすれば、コンテナ内から認識もできる．
もちろんボリュームみたいに、コンテナ内でのパスは指定できる．

注意点としては、デバイスが刺さってないと`docker run`できないこと．
ある意味よいのかもしれないけど、コンテナを作りっぱなしにする使い方の場合はあんまり便利ではない．
そもそも、コンテナ作りっぱぱなしで開発すること自体が間違ってる気がしないでもない．

#### (※ 追記)
　複数のデバイスを扱う場合デバイス名が指す順番などによって変わるため不便です．
　ホストでデバイスファイルに名前をつけたり，関連するデバイスファイルをディレクトリにまとめて，そのディレクトリをボリュームとしてマウントするといいかもしれません．
　デバイス名の固定化についてはベンダIDとプロダクトIDで識別し，udevに追加する方法などががあります．

#### コンテナに特権を与える方法
`docker run`のオプションに`--privileged`を追加する．
これでコンテナ内から全てのホストデバイスが認識可能,アクセス可能状態になる．
ただし、ほんとに全てのデバイスにアクセスが可能になってしまうので注意．

## install

### リポジトリをコピー
```.zsh
git clone https://github.com/Nanahoshi23/MyDockerROS
```

### 設定
必要であれば，シェルの設定とusbデバイスの設定を行なう．

```.zsh
vim src/config/.zshrc
```

```.zsh
vim src/config/90-usb-serial-devices.rules
```

### イメージの作成
```.zsh
cd src
./build.sh
```


### コンテナの作成
マウントするディレクトリを適宜変更する．
```.zsh
```

```.zsh
cd src
./run.sh
```

## 試す
コンテナができたら，シェル接続して`catkin build`してみます．
あとは，普通にROSのビルド，実行環境として使うことができます．
